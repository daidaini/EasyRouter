# HDGwRouter使用说明

## 配置说明
配置文件为config.json，跟可执行文件目录保持一致。 
相关说明在下面进行基本描述:
- "server_port" 是路由服务的监听端口，如果不配置，可以在启动选项中'-p'指定
- "server_thread_cnt" 配置服务端处理请求的工作线程数量，如果不配置，可以在启动选项中'-t'指定
- "dst_addrs" 配置需要路由转发到的交易网关的地址信息
- "dst_addrs.group" 是配置具体对应的我们哪个模块的网关，(选项可为HST2、DDA5等网关模块标识)
- "dst_addrs.biz" 用以配置是什么业务，期权(option)还是股票(stock),或是两融(margin)
- "router_auth" 是用于配置如何获取路由规则的信息
- "router_auth.type" 是配置当前使用哪种路由规则，类型1标识跟恒生系统确认路由目标，类型2是通过本地脚本"check_local_rule.py"的"check_account"方法确定路由目标
- "router_auth.third_system_items" 配置三方模块认证需要的额外的字段名及字段值， 当前用于恒生认证配置需要的固定字段数据信息。
- "router_auth.thread_cnt" 配置用于"router.auth"的线程池大小

### dst_addrs.group 定义
- HST2 (恒生T2网关)
- DDA5 (顶点A5网关)
- DD20 (顶点A2网关)
- HST3 (恒生T3网关)
- HTS_Option (HTS期权网关)
- HTS_Stock (HTS股票网关)
- JSD (金仕达期权网关)
- JSD_Stock (金仕达股票网关)
- ...

### dst_addrs.biz 定义
- option (期权)
- stock (股票)
- margin (两融)


### router_auth.type 定义
- 1 (恒生T2认证)
- 2 (本地脚本按账号进行路由规则确认)

> 配置2 的时候，确保部署有"check_local_rule.py"文件，文件名不可更改，  
> 且确保脚本中有"check_account"方法的正确实现。


## 启动
提供了启动脚本start.sh， 
主要是程序的启动命令：  
```shell
#启动
CURRENT_PATH=`pwd -P`
EXE_NAME=HDGwRouter
CURR_EXE=$CURRENT_PATH/$EXE_NAME

$CURR_EXE >> $CURRENT_PATH/log/cmd_log.txt 2>&1 &
#或者
$CURR_EXE --port=30002 --th_size=1 >> $CURRENT_PATH/log/cmd_log.txt 2>&1 &
```

如果router_auth.type配置了2，使用本地的python3脚本，则需要额外设置下PYTHONPATH环境变量，在启动命令前，加一行如下：
```shell
#PYTHONPATH 设置环境变量
export PYTHONPATH=$CURRENT_PATH
```
这样，只要保证check_local_rule.py文件在程序目录下即可找到















